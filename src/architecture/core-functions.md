# 箱庭のコア機能（最小意味論）

(Normative)

本章は、箱庭が提供する最小意味論（breakdown を防ぐための最小限のセマンティクス）を、実装に依存せず定義する。ここでの定義はすべて規範であり、最適化・ポリシー・運用判断は範囲外とする。

## 1. 分散実行モデル（Parallel-First）
**保証すること**
- 複数アセットが並列に実行されることを前提とする。
- 並列実行下でも実行責任と因果境界が意味論的に確定される。

**決めないこと**
- 実行配置の最適化
- 並列度やスケジューリング戦略

**Invariant:** 並列実行下でも責任と因果境界は意味論的に確定される（実行効率や最適性を保証するものではない）。

## 2. 有界ドリフト（Bounded Drift）
**保証すること**
- 設計時に定義された上限（d_max）内で、論理時間のドリフトが常に有界である。
- 1ノード構成では d_max、分散構成では 2·d_max の範囲に収まる。

**決めないこと**
- d_max 超過時の自動補正
- 物理時間と論理時間の厳密一致

**Invariant:** 論理時間のドリフトは設計上限（d_max / 2·d_max）を超えない（物理時間の一致や遅延の消滅を意味しない）。

## 3. Owner の一意性
**保証すること**
- すべてのEUに対し Owner は常に一意である。
- PDU書き込み責任は曖昧化しない。

**決めないこと**
- Owner 交代の最適化戦略
- Owner の性能評価基準

**Invariant:** いかなる時点でもEUのOwnerは一意である（Ownerの交代自体を禁止するものではない）。

## 4. Epoch（世代識別）
**保証すること**
- 実行責任の世代は Epoch によって一意に識別される。
- Epoch の一致は意味論上の一致として扱われる（等価性ベース）。

**決めないこと**
- Epoch 切替のタイミング最適化
- 具体的な世代番号の採番方式

**Invariant:** Epoch の一致は意味論的な同一性を意味する（物理実行の同時性を意味しない）。

## 5. Commit Point（意味論的確定点）
**保証すること**
- Commit Point において因果境界と責任が意味論的に確定される。
- Commit Point と物理的実行開始の不一致は許容される。

**決めないこと**
- Commit Point の発火ポリシー
- 物理開始を同期させる強制手段

**Invariant:** Commit Point は責任と因果境界の意味論的確定点である（物理的開始の同期点ではない）。

## 6. 責務分離（Conductor / Bridge / Hakoniwa Asset）
**保証すること**
- Conductor は実行責任遷移のみを管理し、数値解法や最適化は扱わない。
- Bridge は Data Plane と Control Plane の境界整合を担保する。
- Hakoniwa Asset は並列実行主体として Data Plane 上で動作する。

**決めないこと**
- Conductor の内部アルゴリズム
- Bridge の通信手法
- Hakoniwa Asset の実装言語・環境

**Invariant:** 責務は Conductor / Bridge / Hakoniwa Asset に分離され、混在しない（単一プロセス実装を否定するものではない）。

## 7. 宣言的設計（Schema + Generator + Validation）
**保証すること**
- 実行構成は宣言的に記述される。
- 設計の整合性は検証される。

**決めないこと**
- 具体的な生成方式
- 検証ツールの実装形態

**Invariant:** 実行構成は宣言的に記述され、整合性が検証される（生成方式やツール選定を拘束しない）。

## 8. Endpoint（因果境界と配信・寿命セマンティクス）
**保証すること**
- Endpoint は単なるメッセージAPIではない。
- Endpoint は因果境界と配信・寿命セマンティクスを定義する。

**決めないこと**
- メッセージ形式や最適化手法
- 配信遅延への数値的な補正

**Invariant:** Endpoint は因果境界と配信・寿命セマンティクスを規定する（汎用メッセージAPIであることを意味しない）。
